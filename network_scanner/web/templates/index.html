<!doctype html>
<html lang="en" data-bs-theme="dark">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Network Scanner Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        body {
            background-color: #0d1117;
        }

        .container {
            max-width: 1400px;
        }

        .card {
            background-color: #161b22;
            border-color: #30363d;
        }

        .table-hover tbody tr:hover td,
        .table-hover tbody tr:hover th {
            background-color: #21262d;
        }

        .status-dot {
            height: 10px;
            width: 10px;
            background-color: #238636;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
        }

        .badge-metrics {
            background-color: #1f6feb;
        }
    </style>
</head>

<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark border-bottom border-secondary mb-4">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="bi bi-hdd-network"></i> Network Scanner
            </a>
            <span class="navbar-text">
                Live Dashboard
            </span>
        </div>
    </nav>

    <div class="container">
        <div class="row mb-4">
            <div class="col">
                <div class="card shadow-sm">
                    <div class="card-header border-secondary">
                        <h5 class="card-title mb-0"><i class="bi bi-router"></i> Discovered Devices</h5>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-dark table-hover mb-0 align-middle">
                                <thead class="table-secondary">
                                    <tr>
                                        <th scope="col" style="cursor: pointer;" onclick="sortTable(0)">Status <i
                                                class="bi bi-arrow-down-up text-muted small"></i></th>
                                        <th scope="col" style="cursor: pointer;" onclick="sortTable(1)">IP Address <i
                                                class="bi bi-arrow-down-up text-muted small"></i></th>
                                        <th scope="col" style="cursor: pointer;" onclick="sortTable(2)">MAC Address <i
                                                class="bi bi-arrow-down-up text-muted small"></i></th>
                                        <th scope="col" style="cursor: pointer;" onclick="sortTable(3)">Vendor <i
                                                class="bi bi-arrow-down-up text-muted small"></i></th>
                                        <th scope="col" style="cursor: pointer;" onclick="sortTable(4)">Type <i
                                                class="bi bi-arrow-down-up text-muted small"></i></th>
                                        <th scope="col" style="cursor: pointer;" onclick="sortTable(5)">Open Ports <i
                                                class="bi bi-arrow-down-up text-muted small"></i></th>
                                        <th scope="col" style="cursor: pointer;" onclick="sortTable(6)">Metrics <i
                                                class="bi bi-arrow-down-up text-muted small"></i></th>
                                        <th scope="col" style="cursor: pointer;" onclick="sortTable(7)">Last Seen <i
                                                class="bi bi-arrow-down-up text-muted small"></i></th>
                                    </tr>
                                </thead>
                                <tbody id="deviceTableBody">
                                    {% for device in devices %}
                                    <tr>
                                        <td><span class="status-dot"></span>Active</td>
                                        <td class="fw-bold">{{ device.ip }}</td>
                                        <td class="font-monospace">{{ device.mac }}</td>
                                        <td>{{ device.vendor }}</td>
                                        <td>
                                            {% if device.type != 'Unknown' %}
                                            <span class="badge bg-secondary">{{ device.type }}</span>
                                            {% else %}
                                            <span class="text-muted">Unknown</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if device.open_ports %}
                                            <small class="font-monospace">
                                                {% for port in device.open_ports[:5] %}
                                                <span class="badge bg-success me-1">{{ port }}</span>
                                                {% endfor %}
                                                {% if device.open_ports|length > 5 %}
                                                <span class="text-muted">+{{ device.open_ports|length - 5 }}</span>
                                                {% endif %}
                                            </small>
                                            {% else %}
                                            <span class="text-muted">-</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if device.metrics_urls %}
                                            <span class="badge badge-metrics">{{ device.metrics_urls|length }}
                                                Endpoints</span>
                                            <br>
                                            <small class="text-muted" style="font-size: 0.75em;">
                                                {% for url in device.metrics_urls %}
                                                <a href="{{ url }}" target="_blank"
                                                    class="link-info text-decoration-none">{{ url }}</a><br>
                                                {% endfor %}
                                            </small>
                                            {% else %}
                                            <span class="text-muted">-</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <script>
                                                document.write(new Date({{ device.last_seen }} * 1000).toLocaleTimeString());
                                            </script>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card-footer border-secondary text-muted text-end">
                        <small>Total Devices: {{ devices|length }}</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
    <script>
        // Auto-refresh every 10 seconds
        setTimeout(function () {
            window.location.reload(1);
        }, 10000);

        function sortTable(n) {
            var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
            table = document.querySelector(".table");
            switching = true;
            dir = "asc";

            while (switching) {
                switching = false;
                rows = table.rows;

                for (i = 1; i < (rows.length - 1); i++) {
                    shouldSwitch = false;

                    x = rows[i].getElementsByTagName("TD")[n];
                    y = rows[i + 1].getElementsByTagName("TD")[n];

                    var xContent = x.innerText.toLowerCase();
                    var yContent = y.innerText.toLowerCase();

                    // Special handling for IP Address (column 1)
                    if (n == 1) {
                        xContent = ipToNum(xContent);
                        yContent = ipToNum(yContent);
                    }

                    if (dir == "asc") {
                        if (xContent > yContent) {
                            shouldSwitch = true;
                            break;
                        }
                    } else if (dir == "desc") {
                        if (xContent < yContent) {
                            shouldSwitch = true;
                            break;
                        }
                    }
                }
                if (shouldSwitch) {
                    rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                    switching = true;
                    switchcount++;
                } else {
                    if (switchcount == 0 && dir == "asc") {
                        dir = "desc";
                        switching = true;
                    }
                }
            }
        }

        function ipToNum(ip) {
            var parts = ip.split('.');
            return Number(parts[0]) * 16777216 + Number(parts[1]) * 65536 + Number(parts[2]) * 256 + Number(parts[3]);
        }
    </script>
</body>

</html>